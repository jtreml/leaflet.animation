(function(){var b=0;var c=["webkit","moz"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());var Cursor={x:0,y:0,init:function(){this.setEvent("mouse");this.setEvent("touch")},setEvent:function(a){var b=document["on"+a+"move"]||function(){};document["on"+a+"move"]=function(c){b(c);Cursor.refresh(c)}},refresh:function(a){if(!a){a=window.event}if(a.type=="mousemove"){this.set(a)}else{if(a.touches){this.set(a.touches[0])}}},set:function(a){if(a.pageX||a.pageY){this.x=a.pageX;this.y=a.pageY}else{if(a.clientX||a.clientY){this.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;this.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop}}}};Cursor.init();var Position={get:function(a){var b=curtop=0;if(a.offsetParent){do{b+=a.offsetLeft;curtop+=a.offsetTop}while((a=a.offsetParent))}return[b,curtop]}};var Dragdealer=function(c,a){if(typeof(c)=="string"){c=document.getElementById(c)}if(!c){return}var b=c.getElementsByTagName("div")[0];if(!b||b.className.search(/(^|\s)handle(\s|$)/)==-1){return}this.init(c,b,a||{});this.setup()};Dragdealer.prototype={init:function(c,b,a){this.wrapper=c;this.handle=b;this.options=a;this.disabled=this.getOption("disabled",false);this.horizontal=this.getOption("horizontal",true);this.vertical=this.getOption("vertical",false);this.slide=this.getOption("slide",true);this.steps=this.getOption("steps",0);this.snap=this.getOption("snap",false);this.loose=this.getOption("loose",false);this.speed=this.getOption("speed",10)/100;this.xPrecision=this.getOption("xPrecision",0);this.yPrecision=this.getOption("yPrecision",0);this.callback=a.callback||null;this.animationCallback=a.animationCallback||null;this.bounds={left:a.left||0,right:-(a.right||0),top:a.top||0,bottom:-(a.bottom||0),x0:0,x1:0,xRange:0,y0:0,y1:0,yRange:0};this.value={prev:[-1,-1],current:[a.x||0,a.y||0],target:[a.x||0,a.y||0]};this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]};this.change=[0,0];this.activity=false;this.dragging=false;this.tapping=false},getOption:function(b,a){return this.options[b]!==undefined?this.options[b]:a},setup:function(){this.setWrapperOffset();this.setBoundsPadding();this.setBounds();this.setSteps();this.addListeners()},setWrapperOffset:function(){this.offset.wrapper=Position.get(this.wrapper)},setBoundsPadding:function(){if(!this.bounds.left&&!this.bounds.right){this.bounds.left=Position.get(this.handle)[0]-this.offset.wrapper[0];this.bounds.right=-this.bounds.left}if(!this.bounds.top&&!this.bounds.bottom){this.bounds.top=Position.get(this.handle)[1]-this.offset.wrapper[1];this.bounds.bottom=-this.bounds.top}},setBounds:function(){this.bounds.x0=this.bounds.left;this.bounds.x1=this.wrapper.offsetWidth+this.bounds.right;this.bounds.xRange=(this.bounds.x1-this.bounds.x0)-this.handle.offsetWidth;this.bounds.y0=this.bounds.top;this.bounds.y1=this.wrapper.offsetHeight+this.bounds.bottom;this.bounds.yRange=(this.bounds.y1-this.bounds.y0)-this.handle.offsetHeight;this.bounds.xStep=1/(this.xPrecision||Math.max(this.wrapper.offsetWidth,this.handle.offsetWidth));this.bounds.yStep=1/(this.yPrecision||Math.max(this.wrapper.offsetHeight,this.handle.offsetHeight))},setSteps:function(){if(this.steps>1){this.stepRatios=[];for(var a=0;a<=this.steps-1;a++){this.stepRatios[a]=a/(this.steps-1)}}},addListeners:function(){var a=this;this.wrapper.onselectstart=function(){return false};this.handle.onmousedown=this.handle.ontouchstart=function(f){a.handleDownHandler(f)};this.wrapper.onmousedown=this.wrapper.ontouchstart=function(f){a.wrapperDownHandler(f)};var d=document.onmouseup||function(){};document.onmouseup=function(f){d(f);a.documentUpHandler(f)};var c=document.ontouchend||function(){};document.ontouchend=function(f){c(f);a.documentUpHandler(f)};var b=window.onresize||function(){};window.onresize=function(f){b(f);a.documentResizeHandler(f)};this.wrapper.onmousemove=function(f){a.activity=true};this.wrapper.onclick=function(f){return !a.activity};this.interval=setInterval(function(){a.animate()},25);a.animate(false,true)},handleDownHandler:function(a){this.activity=false;Cursor.refresh(a);this.preventDefaults(a,true);this.startDrag();this.cancelEvent(a)},wrapperDownHandler:function(a){Cursor.refresh(a);this.preventDefaults(a,true);this.startTap()},documentUpHandler:function(a){this.stopDrag();this.stopTap()},documentResizeHandler:function(a){this.setWrapperOffset();this.setBounds();this.update()},enable:function(){this.disabled=false;this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=true;this.handle.className+=" disabled"},setStep:function(b,c,a){this.setValue(this.steps&&b>1?(b-1)/(this.steps-1):0,this.steps&&c>1?(c-1)/(this.steps-1):0,a)},setValue:function(b,c,a){this.setTargetValue([b,c||0]);if(a){this.groupCopy(this.value.current,this.value.target)}},startTap:function(a){if(this.disabled){return}this.tapping=true;if(a===undefined){a=[Cursor.x-this.offset.wrapper[0]-(this.handle.offsetWidth/2),Cursor.y-this.offset.wrapper[1]-(this.handle.offsetHeight/2)]}this.setTargetOffset(a)},stopTap:function(){if(this.disabled||!this.tapping){return}this.tapping=false;this.setTargetValue(this.value.current);this.result()},startDrag:function(){if(this.disabled){return}this.offset.mouse=[Cursor.x-Position.get(this.handle)[0],Cursor.y-Position.get(this.handle)[1]];this.dragging=true},stopDrag:function(){if(this.disabled||!this.dragging){return}this.dragging=false;var b=this.groupClone(this.value.current);if(this.slide){var a=this.change;b[0]+=a[0]*4;b[1]+=a[1]*4}this.setTargetValue(b);this.result()},feedback:function(){var a=this.value.current;if(this.snap&&this.steps>1){a=this.getClosestSteps(a)}if(!this.groupCompare(a,this.value.prev)){if(typeof(this.animationCallback)=="function"){this.animationCallback(a[0],a[1])}this.groupCopy(this.value.prev,a)}},result:function(){if(typeof(this.callback)=="function"){this.callback(this.value.target[0],this.value.target[1])}},animate:function(d,c){if(d&&!this.dragging){return}if(this.dragging){var a=this.groupClone(this.value.target);var b=[Cursor.x-this.offset.wrapper[0]-this.offset.mouse[0],Cursor.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetOffset(b,this.loose);this.change=[this.value.target[0]-a[0],this.value.target[1]-a[1]]}if(this.dragging||c){this.groupCopy(this.value.current,this.value.target)}if(this.dragging||this.glide()||c){this.update();this.feedback()}},glide:function(){var a=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];if(!a[0]&&!a[1]){return false}if(Math.abs(a[0])>this.bounds.xStep||Math.abs(a[1])>this.bounds.yStep){this.value.current[0]+=a[0]*this.speed;this.value.current[1]+=a[1]*this.speed}else{this.groupCopy(this.value.current,this.value.target)}return true},update:function(){if(!this.snap){this.offset.current=this.getOffsetsByRatios(this.value.current)}else{this.offset.current=this.getOffsetsByRatios(this.getClosestSteps(this.value.current))}this.show()},show:function(){if(!this.groupCompare(this.offset.current,this.offset.prev)){if(this.horizontal){this.handle.style.left=String(this.offset.current[0])+"px"}if(this.vertical){this.handle.style.top=String(this.offset.current[1])+"px"}this.groupCopy(this.offset.prev,this.offset.current)}},setTargetValue:function(a,c){var b=c?this.getLooseValue(a):this.getProperValue(a);this.groupCopy(this.value.target,b);this.offset.target=this.getOffsetsByRatios(b)},setTargetOffset:function(c,d){var a=this.getRatiosByOffsets(c);var b=d?this.getLooseValue(a):this.getProperValue(a);this.groupCopy(this.value.target,b);this.offset.target=this.getOffsetsByRatios(b)},getLooseValue:function(b){var a=this.getProperValue(b);return[a[0]+((b[0]-a[0])/4),a[1]+((b[1]-a[1])/4)]},getProperValue:function(b){var a=this.groupClone(b);a[0]=Math.max(a[0],0);a[1]=Math.max(a[1],0);a[0]=Math.min(a[0],1);a[1]=Math.min(a[1],1);if((!this.dragging&&!this.tapping)||this.snap){if(this.steps>1){a=this.getClosestSteps(a)}}return a},getRatiosByOffsets:function(a){return[this.getRatioByOffset(a[0],this.bounds.xRange,this.bounds.x0),this.getRatioByOffset(a[1],this.bounds.yRange,this.bounds.y0)]},getRatioByOffset:function(c,a,b){return a?(c-b)/a:0},getOffsetsByRatios:function(a){return[this.getOffsetByRatio(a[0],this.bounds.xRange,this.bounds.x0),this.getOffsetByRatio(a[1],this.bounds.yRange,this.bounds.y0)]},getOffsetByRatio:function(b,a,c){return Math.round(b*a)+c},getClosestSteps:function(a){return[this.getClosestStep(a[0]),this.getClosestStep(a[1])]},getClosestStep:function(d){var a=0;var c=1;for(var b=0;b<=this.steps-1;b++){if(Math.abs(this.stepRatios[b]-d)<c){c=Math.abs(this.stepRatios[b]-d);a=b}}return this.stepRatios[a]},groupCompare:function(d,c){return d[0]==c[0]&&d[1]==c[1]},groupCopy:function(d,c){d[0]=c[0];d[1]=c[1]},groupClone:function(b){return[b[0],b[1]]},preventDefaults:function(b,a){if(!b){b=window.event}if(b.preventDefault){b.preventDefault()}b.returnValue=false;if(a&&document.selection){document.selection.empty()}},cancelEvent:function(a){if(!a){a=window.event}if(a.stopPropagation){a.stopPropagation()}a.cancelBubble=true}};L.BinarySearch={_bs_search:function(c,j,a,i){if(j<c[0].t.getTime()){return a}else{if(j>c[c.length-1].t.getTime()){return i}else{if(c.length===1){return 0}}}var g=0;var b=c.length-2;var e,d;var h;var f;while(g<=b){e=c[g].t.getTime();d=c[b+1].t.getTime();f=(j-e)/(d-e);h=Math.floor(g+(b-g)*f);e=c[h].t.getTime();d=c[h+1].t.getTime();if(e>j){b=h}else{if(d<j){g=h+1}else{return h+(j-e)/(d-e)}}}}};L.LatLngAnimated=function(c,a,b){L.LatLng.call(this,c,a);this.t=b};L.LatLngAnimated.prototype=L.LatLng.prototype;L.latlngAnimated=function(e,d,f){return new L.LatLngAnimated(e,d,f)};L.PolylineAnimated=L.Polyline.extend({initialize:function(b,a){L.Polyline.prototype.initialize.call(this,new Array(),a);this._start=Number.MAX_VALUE;this._end=Number.MIN_VALUE;this._latlngsAnimated=b;if(b.length>0){this._start=b[0].t.getTime();this._end=b[b.length-1].t.getTime();this._t=Number.MIN_VALUE}},setTime:function(b){var a=this._latlngsAnimated.length-1;var g=this._bs_search(this._latlngsAnimated,this._t,0,a);var c=this._bs_search(this._latlngsAnimated,b,0,a);this._t=b;if(c<=0){if(g>0){this.setLatLngs(new Array())}return}else{if(c>=a&&g>=a){return}else{var e=g>0?Math.floor(Math.min(g,c)):-1;var d=Math.floor(c);if(c>e){var f=this._latlngsAnimated.slice(e+1,d+1);if(c>d){f.push(this._interpolate(this._latlngsAnimated[d],this._latlngsAnimated[d+1],c-d))}f.unshift(e+1,this.getLatLngs().length);L.PolylineAnimated.prototype.spliceLatLngs.apply(this,f)}else{this.spliceLatLngs(e+1)}}}},_interpolate:function(c,a,b){lat=c.lat+(a.lat-c.lat)*b;lng=c.lng+(a.lng-c.lng)*b;t=c.t.getTime()+(a.t.getTime()-c.t.getTime())*b;return new L.LatLngAnimated(lat,lng,new Date(t))}});L.PolylineAnimated.include(L.BinarySearch);L.polylineAnimated=function(b,a){return new L.PolylineAnimated(b,a)};L.Animator=L.Class.extend({options:{speed:1,stepWidth:1000},initialize:function(a){L.setOptions(this,a);this._geometries=new Array();this._start=Number.MAX_VALUE;this._end=Number.MIN_VALUE;this._endCallbacks=new Array();this._progressCallbacks=new Array()},addAnimatedGeometry:function(a){this._geometries.push(a);this._start=Math.min(this._start,a._start);this._end=Math.max(this._end,a._end)},setTime:function(b){var c=Math.max(this._start,Math.min(b,this._end));if(c===this._t){return}this._t=c;for(var a=0;a<this._geometries.length;a++){this._geometries[a].setTime(c)}},setSpeed:function(a){this.options.speed=a},setStepWidth:function(a){this.options.stepWidth=a},_step:function(a){this.setTime((this._t!==undefined?this._t:this._start)+a)},step:function(a){if(a!==undefined){this._step(a)}else{this._step(this.options.speed*this.options.stepWidth)}},stepBackwards:function(a){if(a!==undefined){this._step(-a)}else{this._step(-this.options.speed*this.options.stepWidth)}},toStart:function(){this.setTime(this._start)},isStart:function(){return this._t<=this._start},_play:function(){this._frameId=window.requestAnimationFrame(this._play.bind(this));if(this._frameT===undefined){this._frameT=new Date().getTime()}else{var a=new Date().getTime();var b=a-this._frameT;this._frameT=a;this._step(this._playDirection*this.options.speed*b);this._executeProgressCallbacks();if((this._playDirection===-1&&this.isStart())||(this._playDirection===1&&this.isEnd())){this._stop();this._executeOnAnimationEndCallbacks()}}},_stop:function(){if(this._frameId!==undefined){window.cancelAnimationFrame(this._frameId);this._frameId=undefined;this._frameT=undefined}},play:function(){this._stop();this._playDirection=1;this._play()},playBackwards:function(){this._stop();this._playDirection=-1;this._play()},pause:function(){this._stop()},toEnd:function(){this.setTime(this._end)},isEnd:function(){return this._t>=this._end},addOnAnimationEndCallback:function(a){this._endCallbacks.push(a)},_executeOnAnimationEndCallbacks:function(){for(var a=0;a<this._endCallbacks.length;a++){this._endCallbacks[a]()}},addProgressCallback:function(a){this._progressCallbacks.push(a)},_executeProgressCallbacks:function(){var a=this.getProgress();for(var b=0;b<this._progressCallbacks.length;b++){this._progressCallbacks[b](a)}},getProgress:function(){return(this._t-this._start)/(this._end-this._start)},setProgress:function(a){this.setTime(this._start+(this._end-this._start)*a)}});L.animator=function(a){return new L.Animator(a)};L.Control.Animation=L.Control.extend({options:{position:"topcenter",playbackSpeed:1,playbackSpeeds:[1,2,5,10,100],stepWidth:1000},initialize:function(a){L.setOptions(this,a);this._animator=new L.Animator({speed:this.options.playbackSpeed,stepWidth:this.options.stepWidth});this._animator.addOnAnimationEndCallback(this._deactivate.bind(this));this._animator.addProgressCallback(this._progress.bind(this))},onAdd:function(c){var b="leaflet-control-animation",a=L.DomUtil.create("div",b+" leaflet-bar");this._map=c;this._toStartButton=this._createIconButton("to-start","Go to beginning",b+"-to-start",a,this.toStart,this);this._stepBackwardsButton=this._createIconButton("step-backwards","Step backwards",b+"-step-backwards",a,this.stepBackwards,this);this._playBackwardsButton=this._createIconButton("play-backwards","Play backwards",b+"-play-backwards",a,this.playBackwards,this);this._slider=this._createSlider("Time slider",b+"-slider",a,this.toStart,this);this._playButton=this._createIconButton("play","Play",b+"-play",a,this.play,this);this._stepButton=this._createIconButton("step","Step",b+"-step",a,this.step,this);this._toEndButton=this._createIconButton("to-end","Go to end",b+"-to-end",a,this.toEnd,this);if(this.options.playbackSpeeds!==undefined&&this.options.playbackSpeeds.length>1){this._speedButton=this._createDropdownButton(this.options.playbackSpeed,this.options.playbackSpeeds,"x","Playback speed",b+"-speed",a,this._speedSelected,this)}return a},addAnimatedGeometry:function(a){this._animator.addAnimatedGeometry(a)},step:function(){this.pause();this._animator.step();this._progress(this._animator.getProgress())},stepBackwards:function(){this.pause();this._animator.stepBackwards();this._progress(this._animator.getProgress())},toStart:function(){this.pause();this._animator.toStart();this._progress(this._animator.getProgress())},play:function(){if(this._activeButton!==this._playButton){this.pause();this._activate(this._playButton);this._animator.play()}else{this.pause()}},playBackwards:function(){if(this._activeButton!==this._playBackwardsButton){this.pause();this._activate(this._playBackwardsButton);this._animator.playBackwards()}else{this.pause()}},pause:function(){this._deactivate();this._animator.pause()},toEnd:function(){this.pause();this._animator.toEnd();this._progress(this._animator.getProgress())},setSpeed:function(a){this._animator.setSpeed(a);this._speedButton.getElementsByTagName("div")[0].innerHTML=a+"x"},_activate:function(a){var b="leaflet-animation-active";L.DomUtil.addClass(a,b);this._activeButton=a},_deactivate:function(){if(this._activeButton!==undefined){var a="leaflet-animation-active";L.DomUtil.removeClass(this._activeButton,a);this._activeButton=undefined}},_createButton:function(d,h,f,a,e,c){var g=L.DomUtil.create("a",f,a);g.innerHTML=d;g.href="#";g.title=h;var b=L.DomEvent.stopPropagation;L.DomEvent.on(g,"click",b).on(g,"mousedown",b).on(g,"dblclick",b).on(g,"click",L.DomEvent.preventDefault).on(g,"click",e,c);return g},_createIconButton:function(e,f,d,a,c,b){return this._createButton('<div class="leaflet-animation-icon leaflet-animation-icon-'+e+'"></div>',f,d,a,c,b)},_createDropdownButton:function(e,k,j,h,f,a,g,b){var d="<div>"+e+j+"</div>";d+="<ul>";for(var c=0;c<k.length;c++){d+='<li><div data-value="'+k[c]+'">'+k[c]+j+"</div></li>"}d+="</ul>";return this._createButton(d,h,f,a,g,b)},_createSlider:function(h,f,b,g,c){var e=L.DomUtil.create("a",f,b);e.innerHTML='<div id="animation-slider" class="dragdealer"><div class="handle"></div></div>';e.title=h;var a=e.getElementsByTagName("div")[0];var i=this;var d=function(){i._dragdealer=new Dragdealer(a,{slide:false,animationCallback:i._slide.bind(i),speed:100,x:i._animator.getProgress()})};window.setTimeout(d,0);return e},_speedSelected:function(b){var a=this._getDropdownValue(b);if(a!==null){this.setSpeed(parseFloat(a))}},_getDropdownValue:function(c){var a=c.srcElement||c.originalTarget;if(a!==undefined){var b=a.getAttribute("data-value");if(b!==null){return b}}return null},_updateDisabled:function(){var b=this._map,a="leaflet-disabled";L.DomUtil.removeClass(this._zoomInButton,a);L.DomUtil.removeClass(this._zoomOutButton,a);if(b._zoom===b.getMinZoom()){L.DomUtil.addClass(this._zoomOutButton,a)}if(b._zoom===b.getMaxZoom()){L.DomUtil.addClass(this._zoomInButton,a)}},_progress:function(a){this._autoSlide=a;if(this._dragdealer!==undefined){this._dragdealer.setValue(a)}},_slide:function(a){if(this._slideTimeout){window.clearTimeout(this._slideTimeout);this._slideTimeout=undefined}if(Math.abs(this._autoSlide-a)<0.00001){this._autoSlide=undefined;return}this.pause();this._slidePercent=a;this._slideTimeout=window.setTimeout(this._slideDone.bind(this),15)},_slideDone:function(){this._animator.setProgress(this._slidePercent)}});L.Map.mergeOptions({animationControl:false});L.Map.addInitHook(function(){this._initAnimationControlPos();if(this.options.animationControl){var a={};if(this.options.playbackSpeed){a.playbackSpeed=this.options.playbackSpeed}if(this.options.playbackSpeeds){a.playbackSpeeds=this.options.playbackSpeeds}if(this.options.stepWidth){a.stepWidth=this.options.stepWidth}this.animationControl=new L.Control.Animation(a);this.addControl(this.animationControl)}});L.control.animation=function(a){return new L.Control.Animation(a)};L.Map.include({_initAnimationControlPos:function(){var c=this._controlCorners,b="leaflet-",a=this._controlContainer;function d(f,g){var e=b+f+" "+b+g;c[f+g]=L.DomUtil.create("div",e,a)}d("top","center")}});